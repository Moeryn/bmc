BOOST_DIRECTORY=@boost_root_directory@

CPPFLAGS=@DEFS@
CFLAGS=@CFLAGS@ -Wextra @SYSCFLAGS@
CXXFLAGS=@CXXFLAGS@ -I$(BOOST_DIRECTORY) -I.

TEST_OBJECTS=test.@OBJEXT@ compiler.@OBJEXT@ score.@OBJEXT@ measure.@OBJEXT@ \
	numbers.@OBJEXT@ brlsym.@OBJEXT@ music.@OBJEXT@
prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@

all: bmc

install: brltr
	@INSTALL@ @INSTALL_OPTION_STRIP@ brltr $(bindir)

bmc: test main.@OBJEXT@ brlsym.@OBJEXT@ compiler.@OBJEXT@ score.@OBJEXT@ measure.@OBJEXT@ numbers.@OBJEXT@ music.@OBJEXT@ ttb/ttb.a fluidsynth.@OBJEXT@
	$(CXX) -o $@ main.@OBJEXT@ brlsym.@OBJEXT@ compiler.@OBJEXT@ score.@OBJEXT@ measure.@OBJEXT@ numbers.@OBJEXT@ music.@OBJEXT@ ttb/ttb.a fluidsynth.@OBJEXT@ -lpthread -licuuc -lfluidsynth

test: $(TEST_OBJECTS) ttb/ttb.a
	$(CXX) -o $@ $(TEST_OBJECTS) ttb/ttb.a @icu_libraries@
	@./$@

brltr: brltr.@OBJEXT@ ttb/ttb.a
	g++ -o $@ brltr.o ttb/ttb.a @LIBS@ @icu_libraries@

clean:
	$(MAKE) -C ttb clean
	rm -f *.@OBJEXT@ *.a text.auto.h brltr bmc tbl2hex test

full_clean: clean
	rm -rf autom4te.cache/ config.cache config.log config.status \
	configure Makefile ttb/Makefile ttb/config.h

ttb/%:
	$(MAKE) -C $(@D) $(@F)

measure.@OBJEXT@: measure.hpp measure_def.hpp measure.cpp
score.@OBJEXT@: score.hpp score_def.hpp
numbers.@OBJEXT@: numbers.hpp numbers_def.hpp numbers.cpp
brlsym.@OBJEXT@: brlsym.hpp brlsym.cpp
compiler.@OBJEXT@: compiler.hpp disambiguate.hpp
test.@OBJEXT@: spirit/qi/primitive/brl.hpp
